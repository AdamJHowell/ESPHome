# bme688.yaml
#sensor:
platform: bme680
address: 0x77
update_interval: 20s

temperature:
    name:                "BME688 Temperature"
    id:                  bme688_temp
    device_class:        "temperature"
    unit_of_measurement: "Â°C"
    accuracy_decimals:   1
    oversampling:        16x
    # on_value:
    #   - mqtt.publish:
    #       topic:         "$mqtt_location/$mqtt_device/bme688/temp"
    #       payload: !lambda |- 
    #                          return to_string( id( bme688_temp ).state );
    on_value:
      - mqtt.publish:
          topic:           "$mqtt_location/$mqtt_device/bme688/temp"
          payload:         !lambda |- 
                             return to_string( id( bme688_temp ).state );

pressure:
    name:                "BME688 Pressure"
    id:                  bme688_pressure
    device_class:        "atmospheric_pressure"
    unit_of_measurement: "hPa"
    accuracy_decimals:   1
    # on_value:
    #   - mqtt.publish:
    #       topic:         "$mqtt_location/$mqtt_device/bme688/pressure"
    #       payload: !lambda |- 
    #                          return to_string( id( bme688_pressure ).state );
    on_value:
      - mqtt.publish:
          topic:           "$mqtt_location/$mqtt_device/bme688/pressure"
          payload:         !lambda |- 
                             return to_string( id( bme688_pressure ).state );

humidity:
    name:                "BME688 Humidity"
    id:                  bme688_humidity
    device_class:        "humidity"
    unit_of_measurement: "%"
    accuracy_decimals:   1
    # on_value:
    #   - mqtt.publish:
    #       topic:         "$mqtt_location/$mqtt_device/bme688/humidity"
    #       payload: !lambda |- 
    #                          return to_string( id( bme688_humidity ).state );
    on_value:
      - mqtt.publish:
          topic:           "$mqtt_location/$mqtt_device/bme688/humidity"
          payload:         !lambda |- 
                             return to_string( id( bme688_humidity ).state );

gas_resistance:
    name:              "BME688 Gas Resistance"
    id:                bme688_gas_resistance
    device_class:      "aqi"
    accuracy_decimals: 0
    # on_value:
    #   - mqtt.publish:
    #       topic:       "$mqtt_location/$mqtt_device/bme688/gas"
    #       payload: !lambda |- 
    #                          return to_string( id( bme688_gas_resistance ).state );
    #   - lambda: |-
    #       ESP_LOGD( "BME688", "Gas resistance: %.0f", id( bme688_gas_resistance ).state );
    on_value:
      - mqtt.publish:
          topic:           "$mqtt_location/$mqtt_device/bme688/gas"
          payload:         !lambda |- 
                             return to_string( id( bme688_gas_resistance ).state );

# platform: template
#     name: "BME688 Indoor Air Quality"
#     id: iaq
#     icon: "mdi:gauge"
#     # caulculation: comp_gas = log(R_gas[ohm]) + 0.04 log(Ohm)/%rh * hum[%rh]
#     lambda: |-
#       return log( id( gas_resistance ).state ) + 0.04 *  id( humidity ).state;
